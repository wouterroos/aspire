@using Turbine.Dashboard.Components.Controls.Chart
@using Turbine.Dashboard.Model
@using Turbine.Dashboard.Model.Otlp
@using Turbine.Dashboard.Otlp.Model
@using Turbine.Dashboard.Resources
@using Turbine.Dashboard.Utils
@using Turbine.Dashboard.Extensions
@using System.Globalization
@using Turbine.Dashboard.Components.Controls.Grid
@using Dialogs = Turbine.Dashboard.Resources.Dialogs
@implements IDialogContentComponent<ExemplarsDialogViewModel>

@inject IStringLocalizer<Dialogs> Loc
@inject IStringLocalizer<ControlsStrings> ControlsStringsLoc

<div style="max-height: 44vh; overflow-y: auto;">
    <FluentDataGrid ResizeLabel="@TurbineFluentDataGridHeaderCell.GetResizeLabel(ControlsStringsLoc)"
                    ResizeType="DataGridResizeType.Discrete"
                    Items="@MetricView"
                    ItemSize="46"
                    GridTemplateColumns="2fr 1fr 1fr 1fr"
                    TGridItem="ChartExemplar">
        <ChildContent>
            <TurbineTemplateColumn Title="@Loc[nameof(Dialogs.ExemplarsDialogTraceColumnHeader)]" TooltipText="@(context => GetTitle(context))" Tooltip="true">
                <span style="padding-left:5px; border-left-width: 5px; border-left-style: solid; border-left-color: @(context.Span != null ? ColorGenerator.Instance.GetColorHexByKey(OtlpApplication.GetResourceName(context.Span.Source, Content.Applications)) : "transparent");">
                    @GetTitle(context)
                </span>
            </TurbineTemplateColumn>
            <TurbineTemplateColumn Title="@Loc[nameof(Dialogs.ExemplarsDialogTimestampColumnHeader)]" TooltipText="@(context => FormatHelpers.FormatDateTime(TimeProvider, TimeProvider.ToLocal(context.Start), MillisecondsDisplay.None, CultureInfo.CurrentCulture))" Tooltip="true">
                @FormatHelpers.FormatTimeWithOptionalDate(TimeProvider, TimeProvider.ToLocal(context.Start), MillisecondsDisplay.Truncated)
            </TurbineTemplateColumn>
            <TurbineTemplateColumn Title="@Loc[nameof(Dialogs.ExemplarsDialogValueColumnHeader)]">
                @FormatMetricValue(context.Value)
            </TurbineTemplateColumn>
            <TurbineTemplateColumn Title="@Loc[nameof(Dialogs.ExemplarsDialogDetailsColumnHeader)]">
                <FluentButton Appearance="Appearance.Lightweight" OnClick="@(() => OnViewDetailsAsync(context))">View</FluentButton>
            </TurbineTemplateColumn>
        </ChildContent>
        <EmptyContent>
            <FluentIcon Icon="Icons.Regular.Size24.ChartMultiple" />&nbsp;@Loc[nameof(ControlsStrings.MetricTableNoMetricsFound)]
        </EmptyContent>
    </FluentDataGrid>
</div>
